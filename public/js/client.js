"use strict";var googleMap=googleMap||{},$=$,google=google,markers=[];googleMap.mapSetup=function(){var o=document.getElementById("map-canvas"),e={zoom:7,minZoom:7,center:new google.maps.LatLng(51.506178,(-.088369)),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,disableDoubleClickZoom:!1,mapTypeControl:!1,scaleControl:!1,navigationControl:!1,streetViewControl:!1};this.map=new google.maps.Map(o,e),this.getChargeSpots(),this.initMarkes()},googleMap.getChargeSpots=function(o){o=o||"",o=""===o?"":"/"+o,$.get("http://localhost:3000/api/chargespots"+o).done(this.loopThroughChargeSpots),this.clearInputPostCode()},googleMap.loopThroughChargeSpots=function(o){console.log(o),console.log("hola"),googleMap.clearMarkers(),$.each(o,function(o,e){setTimeout(function(){googleMap.createMarkerForChargeSpots(e)},500)})},googleMap.createMarkerForChargeSpots=function(o){var e=new google.maps.LatLng(o.Latitude,o.Longitude),n=new google.maps.Marker({position:e,map:this.map,icon:"/images/marker.png",animation:google.maps.Animation.DROP});markers.push(n),googleMap.addInfoWindowForChargeSpots(o,n)},googleMap.addInfoWindowForChargeSpots=function(o,e){var n=this;google.maps.event.addListener(e,"click",function(){"undefined"!=typeof n.infoWindow&&n.infoWindow.close();for(var a="",t=/(.*)(Type 2|3-pin|DC)(.*)/g,s="",i=0;i<o.Connector.length;i++)if(null!==(s=t.exec(o.Connector[i].ConnectorType))){var p=o.Connector[i].ChargePointStatus.replace("In service","available").replace("Out of service","unavailable");a+='<span class="infoConnector"><span class="type-connector">'+s[2]+'</span> &nbsp;&nbsp;&nbsp;&nbsp; <span class="'+p+'" >'+p+"</span></span><br>"}var g='<img class="icon-info" title="FREE" src="../images/free.png">',r="";o.PaymentRequiredFlag&&(g='<img class="icon-info" title="FEE" src="../images/pound.png">'),o.SubscriptionRequiredFlag&&(r='<img class="icon-info" title="You need subscription" src="../images/subscription.png">'),n.infoWindow=new google.maps.InfoWindow({content:'<div class="container-infowindow">\n                  <span class="spot-name">'+o.name+'</span><br>\n                  <span class="spot-PostTown">'+o.PostTown+'</span><br>\n                  <span class="spot-infoConnector">'+a+"</span><br>\n                  "+g+" "+r+'\n                  <span class="user_favourite"><img src="../images/heart.png"></span>\n                </div>'}),n.infoWindow.open(n.map,e),n.map.setCenter(e.getPosition()),n.map.setZoom(15)})},googleMap.clearMarkers=function(){for(var o=0;o<markers.length;o++)markers[o].setMap(null)},googleMap.initMarkes=function(){var o=this;$(".S").on("click",function(){o.getChargeSpots("S")}),$(".F").on("click",function(){o.getChargeSpots("F")}),$(".AC").on("click",function(){o.getChargeSpots("AC")}),$(".DC").on("click",function(){o.getChargeSpots("DC")}),this.$header=$("header"),this.$header.on("submit","form",this.findPostCode)},googleMap.findPostCode=function(o){o&&o.preventDefault();var e="http://localhost:3000/api/chargespots/postcode",n="POST",a=$(this).serialize();console.log(a),$.ajax({url:e,method:n,data:a}).done(googleMap.loopThroughChargeSpots)},googleMap.clearInputPostCode=function(){$(".inputPostCode").val("")},$(googleMap.mapSetup.bind(googleMap));